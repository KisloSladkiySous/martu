---
import Layout from "../layouts/Layout.astro";

import AboutLeftSection from "../components/AboutLeftSection.astro";
import AboutRightSection from "../components/AboutRightSection.astro";
import AdvantagesLeftSection from "../components/AdvantagesLeftSection.astro";
import AdvantagesRightSection from "../components/AdvantagesRightSection.astro";
import Contacts from "../components/Contacts.astro";
import CustomerReviewLeftSection from "../components/CustomerReviewLeftSection.astro";
import CustomerReviewsRightSection from "../components/CustomerReviewsRightSection.astro";
import HeroLeftSection from "../components/HeroLeftSection.astro";
import HeroRightSection from "../components/HeroRightSection.astro";
import PortfolioLeft from "../components/PortfolioLeft.astro";
import PortfolioRight from "../components/PortfolioRight.astro";
import PriceLeft from "../components/PriceLeft.astro";
import PriceRight from "../components/PriceRight.astro";
import WorkflowLeftSection from "../components/WorkflowLeftSection.astro";
import WorkflowRight from "../components/WorkflowRight.astro";

const sections = [
  {
    id: "hero",
    children: [
      {
        component: HeroLeftSection,
        props: {
          className: "pt-4 section-column__wrapper_menu",
        },
        position: "first",
      },
      {
        component: HeroRightSection,
        props: {
          className: "column-content--bordered-bottom",
        },
        position: "second",
      },
    ],
  },

  {
    id: "about",
    children: [
      {
        component: AboutLeftSection,
        props: {
          className: "column-content--bordered-top",
          position: "second",
        },
      },
      {
        component: AboutRightSection,
        props: {
          className: "pt-25",
          position: "first",
        },
      },
    ],
  },

  {
    id: "portfolio",
    children: [
      {
        component: PortfolioLeft,
        props: {
          className: "pt-4 section-column__wrapper_menu",
          position: "first",
        },
      },
      {
        component: PortfolioRight,
        props: {
          className: "column-content--bordered-bottom",
          position: "second",
        },
      },
    ],
  },

  {
    id: "advantages",
    children: [
      {
        component: AdvantagesLeftSection,
        props: {
          className: "column-content--bordered-bottom",
          position: "second",
        },
      },
      {
        component: AdvantagesRightSection,
        props: {
          className: "pt-25",
          position: "first",
        },
      },
    ],
  },

  {
    id: "workflow",
    children: [
      {
        component: WorkflowLeftSection,
        props: {
          className: "pt-4 section-column__wrapper_menu",
          position: "first",
        },
      },
      {
        component: WorkflowRight,
        props: {
          className: "column-content--bordered-bottom column-content--sticky",
          position: "second",
        },
      },
    ],
  },
  {
    id: "price",
    children: [
      {
        component: PriceLeft,
        props: {
          className: "column-content--bordered-top",
        },
      },
      {
        component: PriceRight,
        props: {
          className: "pt-25",
        },
      },
    ],
  },
  {
    id: "reviews",
    children: [
      {
        component: CustomerReviewLeftSection,
        props: {
          className: "pt-4 section-column__wrapper_menu",
        },
      },
      {
        component: CustomerReviewsRightSection,
        props: {},
      },
    ],
  },
  {
    id: "contacts",
    children: [
      {
        component: Contacts,
        props: {},
      },
    ],
  },
];

const renderAnchor = (parentIndex: number, index: number) => {
  if ((parentIndex + 1) % 2 !== 0) {
    if (index === 0) return true;
  } else {
    if (index === 1) return true;
  }
  return false;
};
---

<Layout title="Martu - Свадебное агенство">
  <main class="scroll-container">
    {
      sections.map((section, parentIndex) => (
        <section
          class:list={[
            parentIndex === 7 ? "snap-section-full" : "snap-section",
          ]}
          data-page-index={parentIndex + 1}
          data-page-id={section.id}
        >
          {section.children.map(({ component: Component, props }, index) => (
            <div class={`snap-column snap-column-${parentIndex}-${index}`}>
              <div
                class={`${section.id !== "contacts" ? "section-column" : "section-full"}`}
                id={`${section.id}-${index}`}
                data-section
              >
                {renderAnchor(parentIndex, index) && (
                  <div style="visibility: hidden;" id={section.id} />
                )}

                <Component {...props} />
              </div>
            </div>
          ))}
        </section>
      ))
    }
    <!-- <Contacts /> -->
  </main>
</Layout>

<style>
  .column-content {
    width: 100%;
    display: flex;
    flex-direction: column;
  }

  .snap-section {
    display: contents;
  }

  .snap-column {
    min-height: 100vh;
    scroll-snap-align: start;
    scroll-snap-stop: always;
    display: flex;
    position: relative;
    flex: 1 0 auto;
  }

  @media (min-width: 1025px) {
    .snap-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      scroll-snap-align: start;
    }

    .snap-section-full {
      display: grid;
      grid-template-columns: 1fr;
      /* min-height: 100vh; */
      scroll-snap-align: start;
    }

    .snap-column {
      /* min-height: 100dvh; */
      scroll-snap-align: start;
      scroll-snap-stop: always;
    }
    .snap-column-4-1 {
      position: sticky;
      top: 0;
      height: fit-content;
      scroll-snap-align: unset;
      scroll-snap-stop: unset;
    }
    .snap-column .snap-column-4-0 {
      scroll-snap-align: unset;
      scroll-snap-stop: unset;
    }
    .section-full {
      width: 100%;
    }
  }
</style>
