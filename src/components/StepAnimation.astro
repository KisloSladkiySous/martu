<script>
  import { stagger, animate, inView } from "motion";

  // Определяем, мобильное ли устройство
  const isMobile = typeof window !== "undefined" && window.innerWidth <= 768;

  // Только если НЕ мобильное устройство — запускаем анимацию

  const transition = {
    duration: 1.5,
    ease: [0.5, 0, 0, 1],
  };

  const keyframes = {
    scaleY: [1, 0],
    transformOrigin: "top",
  };

  const keyframesForwards = {
    scaleY: [0, 1],
    transformOrigin: "top",
  };

  inView(
    ".step-animation",
    (element, info) => {
      const lines = Array.from(
        element.querySelectorAll<HTMLElement>(".step-animation__line")
      ).reverse();

      const animation = animate(lines, keyframes, transition);

      // После завершения анимации — скрываем элементы через display: none
      animation.then(() => {
        lines.forEach((line) => {
          // line.style.display = "none";
        });
      });

      // При выходе из области — сбрасываем (если нужно)
      return () => {
        animate(lines, keyframesForwards, transition);
      };
    },
    { amount: 0.9 }
  );
</script>

<div class="step-animation">
  <div class="step-animation__raw">
    <div class="step-animation__line"></div>
  </div>
  <div class="step-animation__raw">
    <div class="step-animation__line"></div>
  </div>
  <div class="step-animation__raw">
    <div class="step-animation__line"></div>
  </div>
  <div class="step-animation__raw">
    <div class="step-animation__line"></div>
  </div>
  <div class="step-animation__raw">
    <div class="step-animation__line"></div>
  </div>
</div>

<style>
  .step-animation__line {
    transform-origin: top;
    background-color: var(--background-color);
    width: 100%;
    height: 100%;
    position: absolute;
    top: 0;
    left: 0;
    z-index: 1;
  }

  .step-animation__raw {
    width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
    z-index: 10;
  }

  .step-animation {
    width: 100%;
    height: 100%;
    position: absolute;
    display: flex;
    flex-direction: column;
    z-index: 10;
    pointer-events: none;
  }
</style>
